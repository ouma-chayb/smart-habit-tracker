<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Smart Habit Tracker</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


<style>
body {
    background: #f6f9fc;
    transition: 0.3s;
}

.dark {
    background: #0f172a;
    color: white;
}

.card {
    border-radius: 14px;
}

.gradient {
    background: linear-gradient(90deg, #2563eb, #7c3aed);
    color: white;
    border-radius: 18px;
    text-align: center;
}

.habit-card {
    transition: 0.3s;
}

.dark .habit-card,
.dark .card {
    background: #1e293b;
    color: white;
}
</style>
</head>

<body>

<div class="container py-5">

<!-- Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h3>
        <i class="fa-solid fa-chart-line text-primary"></i>
        Smart Habit Tracker
    </h3>

    <div class="d-flex gap-2 align-items-center">

        <!-- Dark mode -->
        <button onclick="toggleDarkMode()" class="btn btn-outline-secondary btn-sm">
            ğŸŒ™ Mode sombre
        </button>

        {% if username %}
            <!-- User menu -->
            <div class="dropdown">
                <button class="btn btn-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown">
                    ğŸ‘‹ {{ username }}
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                        <a class="dropdown-item" href="/logout">ğŸšª Logout</a>
                    </li>
                </ul>
            </div>
        {% else %}
            <!-- Sign in -->
            <a href="/login" class="btn btn-primary btn-sm">
                ğŸ” Sign in
            </a>
        {% endif %}

    </div>
</div>



<!-- Welcome -->
<div class="gradient p-4 mb-4 shadow">
    <h3 class="fw-bold">Welcome back ğŸ‘‹</h3>
    <p class="mb-0">Track your habits, visualize progress, and build consistency.</p>
</div>

<!-- Stats -->
<div class="row mb-4 text-center">
    <div class="col-md-6 mb-2">
        <div class="card p-3 shadow-sm">
            <h4>{{ habits|length }}</h4>
            <small>Total Habits</small>
        </div>
    </div>
    <div class="col-md-6 mb-2">
        <div class="card p-3 shadow-sm">
            <h4>{{ habits|sum(attribute='streak') }}</h4>
            <small>Total Streak</small>
        </div>
    </div>
                <div class="d-flex justify-content-between mt-2">
    <a href="/export/csv" class="btn btn-outline-success btn-sm w-50 me-1">
        ğŸ“„ CSV
    </a>

    <a href="/export/pdf" class="btn btn-outline-danger btn-sm w-50 ms-1">
        ğŸ“• PDF
    </a>
</div>
</div>

<!-- Add Habit -->
<div class="card shadow-sm mb-4">
    <div class="card-body">
        <form action="/add" method="post" class="d-flex gap-2">
            <input type="text" name="habit" class="form-control" placeholder="Nouvelle habitude..." required>
            <button class="btn btn-primary">Ajouter</button>
        </form>
    </div>
</div>

<!-- Habits -->
<div class="row mb-5">
{% for habit in habits %}
<div class="col-md-4 mb-3">
    <div class="card habit-card shadow-sm p-3">
        <h5><i class="fa fa-check-circle text-success"></i> {{ habit.name }}</h5>

        <p class="mb-1">ğŸ”¥ Streak : <strong>{{ habit.streak }}</strong> jours</p>

        <small class="text-primary">{{ habit.motivation }}</small>

        <form action="/done" method="post" class="mt-2">
            <input type="hidden" name="habit" value="{{ habit.name }}">
            <button class="btn btn-outline-success btn-sm w-100">
                âœ” Fait aujourdâ€™hui
            </button>


        </form>
    </div>
</div>
{% endfor %}
</div>

<!-- Chart (EN BAS) -->
<div class="card shadow-sm p-4">
    <h5>ğŸ“Š Progress over time</h5>
    <canvas id="progressChart"></canvas>
</div>

</div>

<script>
const labels = {{ labels | tojson }};
const values = {{ values | tojson }};

new Chart(document.getElementById("progressChart"), {
    type: "bar",
    data: {
        labels: labels,
        datasets: [{
            label: "Habits completed",
            data: values,
            backgroundColor: "#3b82f6"
        }]
    },
    options: {
        responsive: true
    }
});
</script>

<script>
function toggleDarkMode(){
    document.body.classList.toggle("dark");
}
</script>

</body>
</html>

